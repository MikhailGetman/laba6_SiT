# RPC Лабораторная работа №6

## 1. Установка библиотеки

Прежде чем писать код, надо установить библиотеку rpclib на C++. Делается так:
1. Заходите в свой проект в Visual Studio
2. В панеле инструментов нажимаете: Проект -> Управление пакетами NuGet...
3. В открывшемся окне переходите в раздел "Обзор" и пишите в поисковую строку rpclib
4. Нажимаете на лупу. Выпадает список библиотек
5. Выбираете библиотеку с названием "native.rpclib-static-MD" (версия должна быть 2.3.0)
6. Устанавливаете данную библиотеку

Это необходимо сделать и для проекта с сервером, и для проекта с клиентом
## 2. Используемые заглушки

__$port__ - порт, который вы хотите использовать для RPC-взаимодействия

__$command__ - название процедуры RPC. Вы вольны назвать процедуру так, как вам этого захочется. Необязательно, чтобы у вас в проекте была функция с названием $command

__$params__ - это набор параметров, которые принимаются во внимание lambda обработчиком

__$response_type__ - это тип значения, возвращаемого с сервера клиенту


## 3. Шаблон для сервера

```
#include "rpc/server.h"
//Нужные для вас инклуды

using namespace std;

int main() {
  //Инициализация сервера и ориентирование его на порт
	rpc::server srv($port); 

  //Добавление обработчика на удаленную команду
  //Второй аргумент: lambda функция-обработчик (аргументы этой функции - это присылаемые вместе с командой параметры с клиента ($params) )

	srv.bind("$command", []($params) {

		//Код для вашей задачи
      
    $response_type response = ... ;
		return response; //возврат ответа клиенту
	});

  //запуск RPC-сервера для прослушивания запросов от клиентов
	srv.run();

	return 0;
}
```

## 4. Шаблон для клиента
```
#include "rpc/client.h"
//Нужные для вас инклуды

using namespace std;

int main() {

  //Инициализация клиентского интерфейса (порт такой же, какой поставили на сервере)
	rpc::client client("localhost", $port);

  //Ваш код

  //----------------------------------------------------------------
  //Пример отправки RPC-запроса на сервер:

	$response_type result;

  //Отправка RPC-запроса на сервер и запись результата 

  result = client.call("$command", $params).as<$reponse_type>();
  //-----------------------------------------------------------------
	return 0;
}
```

## 5. Дополнения

### Вызов нескольких различных процедур

Если вам нужно реализовать несколько разных процедур, то просто добавляете в код сервера новую команду:
```
srv.bind("$command2", []($params2) {
  //Обрабытваем новую процедуру
  //Возвращаем результат
});
```
А в клиенте просто вызываете
```
client.call("$command2", $params2).as<$reponse_type2>();
```
И так делаете столько раз, сколько нужно вам различных процедур

### 6. Полезные ссылки
Репозиторий библиотеки: 
https://github.com/rpclib/rpclib

Документация по библиотеке rpclib:
http://rpclib.net/
